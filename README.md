# intercompany-importer

## STORED PROCEDURE
```bash
CREATE PROCEDURE APPARKA_DEV.SP_INSERT_INTERCOMPANY_CONCEPT (
    IN P_TIPO NVARCHAR(100),
    IN P_PEP NVARCHAR(100),
    IN P_KOSTL NVARCHAR(100),
    IN P_CONCEPTO NVARCHAR(100),
    IN P_RACCT NVARCHAR(100),
    IN P_MARKUP DECIMAL(5,2),
    IN P_ORD_COMPRA NVARCHAR(100),
    IN P_POSICION NVARCHAR(100),
    IN P_HABILITAR BOOLEAN,
    IN P_COD_SERV NVARCHAR(100)
)
LANGUAGE SQLSCRIPT
AS
BEGIN

    DECLARE V_TYPE_CODE         NVARCHAR(36);
    DECLARE V_PROJECTELEMENT    NVARCHAR(36);
    DECLARE V_CONCEPT_CODE      NVARCHAR(36);

    SELECT CODE
    INTO V_TYPE_CODE
    FROM INTERCOMPANY_RECORDTYPE
    WHERE NAME = :P_TIPO;

    SELECT CODE
    INTO V_CONCEPT_CODE
    FROM INTERCOMPANY_CONCEPTTYPE
    WHERE NAME = :P_CONCEPTO;

    IF :P_PEP IS NOT NULL AND LENGTH(:P_PEP) > 0 THEN
        SELECT PROJECTELEMENTUUID
        INTO V_PROJECTELEMENT
        FROM MASTER_DATA_PEPELEMENT
        WHERE PROJECTELEMENT = :P_PEP;
    ELSE
        V_PROJECTELEMENT := NULL;
    END IF;

    INSERT INTO INTERCOMPANY_CONCEPT (
        ID,
        CREATEDAT,
        ENABLED,
        MARKUP,
        TO_TYPE_CODE,
        TO_GLACCOUNT_GLACCOUNT,
        TO_GLACCOUNT_COMPANYCODE,
        TO_CONCEPTTYPE_CODE,
        TO_PURCHASEORDERITEM_PURCHASEORDER,
        TO_PURCHASEORDERITEM_PURCHASEORDERITEM,
        TO_PEPELEMENT_PROJECTELEMENTUUID,
        TO_COSTCENTER_COSTCENTER
    )
    VALUES (
        NEWUID(),
        CURRENT_TIMESTAMP,
        TRUE,
        P_MARKUP,
        V_TYPE_CODE,
        P_RACCT,
        '5720',
        V_CONCEPT_CODE,
        P_ORD_COMPRA,
        P_POSICION,
        V_PROJECTELEMENT,
        NULLIF(P_KOSTL, '')
    );

END;
